<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recruiting Intelligence Dashboard v2</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-4">Recruiting Intelligence Dashboard â€” v2</h1>
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-4 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">Total Candidates</h3>
        <p id="total-candidates" class="text-2xl font-bold text-gray-900">-</p>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">ELITE Tier</h3>
        <p id="elite-count" class="text-2xl font-bold text-green-600">-</p>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">High Potential</h3>
        <p id="high-potential-count" class="text-2xl font-bold text-blue-600">-</p>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">Avg Score</h3>
        <p id="avg-score" class="text-2xl font-bold text-purple-600">-</p>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
      <div class="flex gap-4">
        <input id="search" class="flex-1 border rounded px-3 py-2" placeholder="Search by name or email..." />
        <select id="tier-filter" class="border rounded px-3 py-2">
          <option value="">All Tiers</option>
          <option value="ELITE">ELITE</option>
          <option value="HIGH_POTENTIAL">HIGH_POTENTIAL</option>
          <option value="SOLID">SOLID</option>
          <option value="DEVELOPING">DEVELOPING</option>
        </select>
        <button onclick="loadCandidates()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Refresh
        </button>
      </div>
    </div>

    <!-- Candidates Table -->
    <div class="bg-white rounded-lg shadow">
      <div class="p-4 border-b">
        <h2 class="text-lg font-semibold">Latest Candidates</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidate</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tier</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Applied</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody id="candidates" class="bg-white divide-y divide-gray-200">
            <!-- Candidates will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Benchmarks Section -->
    <div class="mt-6 bg-white rounded-lg shadow p-4">
      <h3 class="text-lg font-semibold mb-4">Benchmarks & Analytics</h3>
      <div id="benchmarks" class="text-sm text-gray-700"></div>
    </div>
  </div>

  <script>
  const API_KEY = 'demo_api_key_12345';
  const API_BASE = 'http://localhost:8000';

  async function loadBenchmarks() {
    try {
      const res = await fetch(`${API_BASE}/api/enhanced-assessment/benchmarks`, { 
        headers: { 'x-api-key': API_KEY } 
      });
      const data = await res.json();
      
      const benchmarksEl = document.getElementById('benchmarks');
      benchmarksEl.innerHTML = `
        <div class="grid grid-cols-3 gap-4">
          <div>
            <strong>Total Candidates:</strong> ${data.totalCandidates || 0}
          </div>
          <div>
            <strong>Average Score:</strong> ${Math.round(data.averageScore || 0)}
          </div>
          <div>
            <strong>Distribution:</strong> ${data.distribution ? data.distribution.length + ' buckets' : 'N/A'}
          </div>
        </div>
      `;
    } catch (error) {
      console.error('Failed to load benchmarks:', error);
    }
  }

  async function loadCandidates() {
    try {
      // First get the tenant ID using the API key
      const tenantRes = await fetch(`${API_BASE}/api/leads`, { 
        headers: { 'x-api-key': API_KEY } 
      });
      
      if (!tenantRes.ok) {
        throw new Error(`HTTP ${tenantRes.status}: ${tenantRes.statusText}`);
      }
      
      const candidates = await tenantRes.json();
      
      // Update stats
      document.getElementById('total-candidates').textContent = candidates.length;
      document.getElementById('elite-count').textContent = candidates.filter(c => c.tier === 'ELITE').length;
      document.getElementById('high-potential-count').textContent = candidates.filter(c => c.tier === 'HIGH_POTENTIAL').length;
      
      const avgScore = candidates.length > 0 
        ? Math.round(candidates.reduce((sum, c) => sum + (c.final_score || 0), 0) / candidates.length)
        : 0;
      document.getElementById('avg-score').textContent = avgScore;

      // Render candidates
      const tbody = document.getElementById('candidates');
      tbody.innerHTML = candidates.map(candidate => `
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                  <span class="text-sm font-medium text-blue-600">
                    ${(candidate.first_name || '').charAt(0)}${(candidate.last_name || '').charAt(0)}
                  </span>
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">
                  ${candidate.first_name || ''} ${candidate.last_name || ''}
                </div>
                <div class="text-sm text-gray-500">${candidate.email || ''}</div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${candidate.final_score || 'N/A'}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
              ${candidate.tier === 'ELITE' ? 'bg-green-100 text-green-800' : 
                candidate.tier === 'HIGH_POTENTIAL' ? 'bg-blue-100 text-blue-800' :
                candidate.tier === 'SOLID' ? 'bg-yellow-100 text-yellow-800' :
                'bg-gray-100 text-gray-800'}">
              ${candidate.tier || 'N/A'}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${candidate.status || 'New'}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${new Date(candidate.created_at).toLocaleDateString()}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button class="text-blue-600 hover:text-blue-900 mr-3">View</button>
            <button class="text-green-600 hover:text-green-900">Contact</button>
          </td>
        </tr>
      `).join('');
      
    } catch (error) {
      console.error('Failed to load candidates:', error);
      document.getElementById('candidates').innerHTML = `
        <tr><td colspan="6" class="px-6 py-4 text-center text-red-600">
          Failed to load candidates: ${error.message}
        </td></tr>
      `;
    }
  }

  // Filter functionality
  document.addEventListener('input', (e) => {
    if (e.target.id === 'search') {
      const query = e.target.value.toLowerCase();
      const rows = Array.from(document.querySelectorAll('#candidates tr'));
      rows.forEach(row => {
        const name = row.querySelector('td:first-child').textContent.toLowerCase();
        const email = row.querySelector('td:first-child .text-gray-500').textContent.toLowerCase();
        const visible = name.includes(query) || email.includes(query);
        row.style.display = visible ? '' : 'none';
      });
    }
  });

  document.addEventListener('change', (e) => {
    if (e.target.id === 'tier-filter') {
      const tier = e.target.value;
      const rows = Array.from(document.querySelectorAll('#candidates tr'));
      rows.forEach(row => {
        const candidateTier = row.querySelector('td:nth-child(3) span').textContent;
        const visible = !tier || candidateTier === tier;
        row.style.display = visible ? '' : 'none';
      });
    }
  });

  // WebSocket for real-time updates
  const ws = new WebSocket('ws://localhost:8001');
  ws.onmessage = () => { 
    loadCandidates(); 
    loadBenchmarks(); 
  };
  ws.onerror = () => console.log('WebSocket connection failed, continuing without real-time updates');

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    loadCandidates();
    loadBenchmarks();
  });
  </script>
</body>
</html>


